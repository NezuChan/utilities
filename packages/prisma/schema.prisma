generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Guild {
  guildId              String
  clientId             String
  locale               String              @default("en-US")
  DJRoles              DJRole[]
  DJUsers              DJUser[]
  prefix               String              @default("n!")

  defaultVolume        defaultVolume?
  clearQueueAfterEnd   clearQueueAfterEnd?
  DJMode               DJMode?
  autoPlay             autoPlay?
  announceTrackStart   announceTrackStart?
  stayInVc             StayInVc?
  phising              Phising?
  invite               Invite?
  cases                Case[]
  tempVoices           TempVoice[]

  premiumTierType      TierType            @default(FREE)
  premiumActivatedBy   String?

  @@id([guildId, clientId])
}

model Instance {
  id                  Int                 @id @default(autoincrement())
  instanceId          String              @unique
  guildId             String
  userId              String
  type                String
  createdAt           DateTime            @default(now())

  user                User                @relation(fields: [userId], references: [userId], onDelete: Cascade, onUpdate: NoAction)
}

model TempVoice {    
  guildId             String
  clientId            String
  channelId           String
  parentChannelId     String
  ownerId             String
  taskId              String?

  guild               Guild               @relation(fields: [guildId, clientId], references: [guildId, clientId], onDelete: Cascade, onUpdate: NoAction)
  @@id([guildId, clientId])
}

model Case {      
  guildId             String
  clientId            String
  caseId              String              @db.VarChar
  userId              String
  reason              String
  executorId          String
  type                CaseType

  guild               Guild               @relation(fields: [guildId, clientId], references: [guildId, clientId], onDelete: Cascade, onUpdate: NoAction)
  @@id([guildId, clientId])
}

model DJRole {           
  roleId              String              @db.VarChar
  authorId            String
  guildId             String
  clientId            String

  guild               Guild               @relation(fields: [guildId, clientId], references: [guildId, clientId], onDelete: Cascade, onUpdate: NoAction)
  @@id([guildId, clientId, roleId])
}

model DJUser {  
  userId              String
  authorId            String
  guildId             String     
  clientId            String
         
  guild               Guild               @relation(fields: [guildId, clientId], references: [guildId, clientId], onDelete: Cascade, onUpdate: NoAction)
  @@id([guildId, clientId, userId])
}

model defaultVolume {
  guildId              String
  clientId             String
  activatedBy          String
  defaultVolume        Int                 @default(100)

  guild                Guild               @relation(fields: [guildId, clientId], references: [guildId, clientId], onDelete: Cascade, onUpdate: NoAction)
  @@id([guildId, clientId])
}

model clearQueueAfterEnd {
  guildId              String
  clientId             String
  activatedBy          String
  enabled              Boolean             @default(true)
  
  guild                Guild               @relation(fields: [guildId, clientId], references: [guildId, clientId], onDelete: Cascade, onUpdate: NoAction)
  @@id([guildId, clientId])
}

model DJMode {
  guildId              String
  clientId             String
  activatedBy          String
  enabled              Boolean             @default(false)
  
  guild                Guild               @relation(fields: [guildId, clientId], references: [guildId, clientId], onDelete: Cascade, onUpdate: NoAction)
  @@id([guildId, clientId])
}

model autoPlay {
  guildId          String
  clientId         String
  activatedBy      String
  enabled          Boolean @default(false)
  
  guild            Guild   @relation(fields: [guildId, clientId], references: [guildId, clientId], onDelete: Cascade, onUpdate: NoAction)
  @@id([guildId, clientId])
}

model announceTrackStart {
  guildId          String
  clientId         String
  activatedBy      String
  enabled          Boolean @default(true)
  channel          String?
  
  guild            Guild   @relation(fields: [guildId, clientId], references: [guildId, clientId], onDelete: Cascade, onUpdate: NoAction)
  @@id([guildId, clientId])
}

model StayInVc {
  guildId          String
  clientId         String
  activatedBy      String
  enabled          Boolean @default(false)
  
  guild            Guild   @relation(fields: [guildId, clientId], references: [guildId, clientId], onDelete: Cascade, onUpdate: NoAction)
  @@id([guildId, clientId])
}

model Invite {
  id          Int           
  guildId     String
  clientId    String
  enabled     Boolean       @default(false)
  adminBypass Boolean       @default(false)

  guild       Guild         @relation(fields: [guildId, clientId], references: [guildId, clientId], onDelete: Cascade, onUpdate: NoAction)
  @@id([guildId, clientId])
}

model Phising {
  id        Int           
  guildId   String        @unique
  clientId  String
  enabled   Boolean       @default(false)
  level     PhisingLevel  @default(MEDIUM)

  guild     Guild         @relation(fields: [guildId, clientId], references: [guildId, clientId], onDelete: Cascade, onUpdate: NoAction)
  @@id([guildId, clientId])
}

model User {
  id            Int         
  userId        String      @unique
  patreonUserId String?     @unique
  tier          TierType    @default(FREE)
  type          PremiumType @default(OTHER)

  instances     Instance[]

  additionalTracksSize    Int @default(0)
  additionalPlaylistsSize Int @default(0)
  tier1Tickets            Int @default(0)
  tier2Tickets            Int @default(0)
}

model Playlist {
  playlistId           String @id @db.VarChar
  userId               String
  playlistName         String
  trackLimit           Int    @default(20)

  tracks               PlaylistTrack[]
}

model PlaylistTrack {
  trackId         String @id @db.VarChar
  userId          String
  playlistId      String
  track           Json

  playlist        Playlist @relation(fields: [playlistId], references: [playlistId], onDelete: Cascade, onUpdate: NoAction)
}

enum CaseType {
  BAN
  KICK
  MUTE
  UNBAN
  UNMUTE
  WARN
}

enum PhisingLevel {
  LOW
  MEDIUM
  HIGH
  HIGHEST
}

enum TierType {
  FREE
  SUPPORTER
  TIER_1
  TIER_2
  TIER_3
}

enum PremiumType {
  OTHER
  PATREON
  GIVEAWAY
}